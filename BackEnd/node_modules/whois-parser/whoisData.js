var request = require('request'),
    htmlToText = require('html-to-text'),
    validator = require('validator');

//var whois = require('whois-ux');
//
//whois.whois('217.14.80.10', function (err, data){
//    console.log('DATA !!!!\n', data);
//});

getWhoisData = function(ip, cb){
    //console.log(validator.isIP(ip,4))
    if(validator.isIP(ip,4)||validator.isIP(ip,6)){
        var options = {
            url: 'http://bgp.he.net/ip/'+ip,
            method: 'GET',
            headers: {'user-agent': 'node.js'}
        };
        request(options, function(error, response, body) {
            if(!error && body){
                var text = htmlToText.fromString(body.slice(body.indexOf('<pre>'), body.indexOf('</pre>')+6))
                return  cb(null, text);
            }
            else{
                return cb("Can`t get information.")
            }
        })
    }else{
        return cb("Incorrect ip.")
    }
}

exports.getWhoisData = getWhoisData;

